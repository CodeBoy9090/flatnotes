<Page
    x:Class="FlatNotes.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:FlatNotes.Controls"
    xmlns:utils="using:FlatNotes.Utils"
    xmlns:models="using:FlatNotes.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <DataTemplate x:Key="NavLinkItemTemplate" x:DataType="utils:NavLink">
            <StackPanel Orientation="Horizontal">
                <SymbolIcon Width="68" Symbol="{x:Bind Symbol}" VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind Label}" VerticalAlignment="Center"/>
            </StackPanel>
        </DataTemplate>


        <Style TargetType="ListViewItem">
            <Setter Property="FontWeight" Value="Medium"/>
            
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <GridViewItemPresenter 
                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" 
                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                            CheckBrush="{ThemeResource ListViewItemCheckThemeBrush}"
                            CheckHintBrush="{ThemeResource ListViewItemCheckHintThemeBrush}"
                            CheckSelectingBrush="{ThemeResource ListViewItemCheckSelectingThemeBrush}"
                            ContentMargin="0"
                            ContentTransitions="{TemplateBinding ContentTransitions}"
                            DisabledOpacity="{ThemeResource ListViewItemDisabledThemeOpacity}"
                            DragBackground="{ThemeResource ListViewItemDragBackgroundThemeBrush}"
                            DragForeground="{ThemeResource ListViewItemDragForegroundThemeBrush}"
                            DragOpacity="{ThemeResource ListViewItemDragThemeOpacity}"
                            FocusBorderBrush="{ThemeResource ListViewItemFocusBorderThemeBrush}"
                            Padding="{TemplateBinding Padding}"
                            PlaceholderBackground="{ThemeResource ListViewItemPlaceholderBackgroundThemeBrush}"
                            PointerOverBackground="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}"
                            PointerOverBackgroundMargin="1"
                            ReorderHintOffset="{ThemeResource ListViewItemReorderHintThemeOffset}"
                            SelectedBackground="{ThemeResource ListViewItemSelectedBackgroundThemeBrush}"
                            SelectedBorderThickness="{ThemeResource ListViewItemCompactSelectedBorderThemeThickness}"
                            SelectedForeground="{ThemeResource ListViewItemSelectedForegroundThemeBrush}"
                            SelectedPointerOverBackground="{ThemeResource ListViewItemSelectedPointerOverBackgroundThemeBrush}"
                            SelectedPointerOverBorderBrush="{ThemeResource ListViewItemSelectedPointerOverBorderThemeBrush}"
                            SelectionCheckMarkVisualEnabled="False" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Name="NotesGridViewStyle" x:Key="NotesGridViewStyle" TargetType="GridViewItem">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewItem">
                        <GridViewItemPresenter 
                            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" 
                            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                            CheckBrush="{ThemeResource ListViewItemCheckThemeBrush}"
                            CheckHintBrush="{ThemeResource ListViewItemCheckHintThemeBrush}"
                            CheckSelectingBrush="{ThemeResource ListViewItemCheckSelectingThemeBrush}"
                            ContentMargin="0"
                            ContentTransitions="{TemplateBinding ContentTransitions}"
                            DisabledOpacity="{ThemeResource ListViewItemDisabledThemeOpacity}"
                            DragBackground="{ThemeResource ListViewItemDragBackgroundThemeBrush}"
                            DragForeground="{ThemeResource ListViewItemDragForegroundThemeBrush}"
                            DragOpacity="{ThemeResource ListViewItemDragThemeOpacity}"
                            FocusBorderBrush="{ThemeResource ListViewItemFocusBorderThemeBrush}"
                            Padding="{TemplateBinding Padding}"
                            PlaceholderBackground="{ThemeResource ListViewItemPlaceholderBackgroundThemeBrush}"
                            PointerOverBackground="Transparent"
                            PointerOverBackgroundMargin="1"
                            ReorderHintOffset="{ThemeResource ListViewItemReorderHintThemeOffset}"
                            SelectedBackground="{ThemeResource ListViewItemSelectedBackgroundThemeBrush}"
                            SelectedBorderThickness="{ThemeResource ListViewItemCompactSelectedBorderThemeThickness}"
                            SelectedForeground="{ThemeResource ListViewItemSelectedForegroundThemeBrush}"
                            SelectedPointerOverBackground="{ThemeResource ListViewItemSelectedPointerOverBackgroundThemeBrush}"
                            SelectedPointerOverBorderBrush="{ThemeResource ListViewItemSelectedPointerOverBorderThemeBrush}"
                            SelectionCheckMarkVisualEnabled="False" />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>

                    <VisualState.Setters>
                        <Setter Target="ActionsCommandBarContainer.Grid.Row" Value="2" />
                        <Setter Target="NotesListView.Margin" Value="0"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="600" />
                    </VisualState.StateTriggers>

                    <VisualState.Setters>
                        <Setter Target="ActionsCommandBarContainer.Grid.Row" Value="0" />
                        <Setter Target="NotesListView.Margin" Value="48,24,48,12"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800" />
                    </VisualState.StateTriggers>

                    <VisualState.Setters>
                        <Setter Target="NotesListView.Margin" Value="120,24,120,12"/>
                    </VisualState.Setters>
                </VisualState>

            <VisualState>
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="1200" />
                </VisualState.StateTriggers>

                <VisualState.Setters>
                    <Setter Target="NotesListView.Margin" Value="250,24,250,12"/>
                </VisualState.Setters>
            </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <SplitView x:Name="MainSplitView" PaneBackground="{StaticResource SystemControlBackgroundAltHighBrush}" 
            DisplayMode="Overlay" IsPaneOpen="False" CompactPaneLength="68" OpenPaneLength="260" Canvas.ZIndex="100">
            <SplitView.Pane>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <AppBarButton IsCompact="True" Label="Menu" Click="MenuToggleButton_Click" ToolTipService.ToolTip="Close menu" ToolTipService.Placement="Right">
                        <FontIcon Glyph="&#xE700;"/>
                    </AppBarButton>
                    
                    <ListView x:Name="NavLinksList" Grid.Row="1" Margin="0,12,12,12" Padding="0" SelectionMode="Single" 
                        ItemTemplate="{StaticResource NavLinkItemTemplate}" VerticalAlignment="Stretch"
                        ItemClick="NavLinksList_ItemClick" IsItemClickEnabled="True"
                        ItemsSource="{x:Bind NavLinks}">

                        <ListView.ItemContainerTransitions>
                            <TransitionCollection/>
                        </ListView.ItemContainerTransitions>

                        <ListView.Footer>
                            <ListView x:Name="NavFooterLinksList" Grid.Row="1" Margin="0" Padding="0" SelectionMode="None" 
                                ItemTemplate="{StaticResource NavLinkItemTemplate}" VerticalAlignment="Stretch" 
                                ItemClick="NavLinksList_ItemClick" IsItemClickEnabled="True" ScrollViewer.VerticalScrollMode="Disabled"
                                ItemsSource="{x:Bind NavFooterLinks}">
                                <ListView.ItemContainerTransitions>
                                    <TransitionCollection/>
                                </ListView.ItemContainerTransitions>
                            </ListView>
                        </ListView.Footer>
                    </ListView>
                </Grid>
            </SplitView.Pane>

            <SplitView.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid x:Name="ActionsCommandBarContainer" Grid.Row="0" Background="{StaticResource CommandBarBackgroundThemeBrush}" RequestedTheme="Dark">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <AppBarButton x:Name="MenuToggleButton" IsCompact="True" Label="Menu" Click="MenuToggleButton_Click" ToolTipService.ToolTip="Open menu" ToolTipService.Placement="Right">
                            <FontIcon Glyph="&#xE700;" Foreground="{StaticResource CommandBarForegroundThemeBrush}"/>
                        </AppBarButton>

                        <CommandBar Grid.Column="1" HorizontalAlignment="Right">
                            <CommandBar.PrimaryCommands>
                                <AppBarButton x:Uid="NoteTextType" Label="text" Command="{Binding CreateTextNoteCommand}" Icon="Add" ToolTipService.Placement="Bottom" ToolTipService.ToolTip="New text note"/>
                                <AppBarButton x:Uid="NoteChecklistType" Label="checklist" Command="{Binding CreateChecklistNoteCommand}" Icon="List" ToolTipService.Placement="Bottom" ToolTipService.ToolTip="New checklist note"/>
                                <AppBarButton x:Uid="PhotoAppBarButton" Icon="Camera" Label="photo" Command="{Binding OpenImagePickerCommand}" ToolTipService.Placement="Bottom" ToolTipService.ToolTip="New note from image or camera"/>
                                <!--<AppBarButton x:Uid="AudioAppBarButton" Icon="Microphone" Label="audio" IsEnabled="False" ToolTipService.Placement="Bottom" ToolTipService.ToolTip="New audio note"/>-->
                            </CommandBar.PrimaryCommands>
                        </CommandBar>
                    </Grid>
                    
                    <GridView x:Name="NotesListView" Grid.Row="1"  Margin="12,24" HorizontalAlignment="Center" HorizontalContentAlignment="Stretch"
                          ItemsSource="{x:Bind Path=viewModel.Notes}" SelectionMode="None"
                          CanReorderItems="False" CanDragItems="False" AllowDrop="False" 
                          ItemContainerStyle="{StaticResource NotesGridViewStyle}">

                        <GridView.ItemContainerTransitions>
                            <TransitionCollection>
                                <EntranceThemeTransition IsStaggeringEnabled="True" FromVerticalOffset="200" FromHorizontalOffset="0"/>
                                <!--<NavigationThemeTransition/>
                            <ContentThemeTransition/>
                            <AddDeleteThemeTransition/>
                            <ReorderThemeTransition/>-->
                            </TransitionCollection>
                        </GridView.ItemContainerTransitions>

                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <local:FluidGrid x:Name="NotesFluidGrid" Margin="10" ItemMinWidth="180"/>
                                <!--<RelativePanel Margin="-6" AllowDrop="False"/>-->
                                <!--<ItemsWrapGrid AllowDrop="True" ItemWidth="200" MaximumRowsOrColumns="4" Orientation="Horizontal"/>-->
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>

                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="models:Note">
                                <Grid Background="{x:Bind Color.Color}">
                                    <StackPanel Margin="12,12,12,36">
                                        <TextBlock Text="{x:Bind Title}" Foreground="{StaticResource AppNoteForegroundBrush}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="0,0,0,6" FontWeight="Bold" MaxLines="1" Visibility="{Binding Title, Converter={StaticResource NullableToVisibilityConverter}}"/>
                                        <TextBlock Text="{x:Bind Text}" Foreground="{StaticResource AppNoteForegroundBrush}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="0,0,0,6" FontWeight="SemiLight" MaxLines="3" Visibility="{Binding Text, Converter={StaticResource NullableToVisibilityConverter}}" />
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>
                </Grid>
            </SplitView.Content>
        </SplitView>
    </Grid>
</Page>
